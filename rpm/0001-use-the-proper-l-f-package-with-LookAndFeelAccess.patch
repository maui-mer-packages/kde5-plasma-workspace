From 067f0357a15ee6e98c1b7c719c819bff8ac9a819 Mon Sep 17 00:00:00 2001
From: Marco Martin <notmart@gmail.com>
Date: Fri, 15 Aug 2014 17:54:06 +0200
Subject: [PATCH] use the proper l&f package, with LookAndFeelAccess

still not enough but a part of 337757
CCBUG:337757
---
 shell/shellcorona.cpp | 16 ++++------------
 shell/shellcorona.h   |  2 --
 2 files changed, 4 insertions(+), 14 deletions(-)

diff --git a/shell/shellcorona.cpp b/shell/shellcorona.cpp
index 084d4f8..d8e93a4 100644
--- a/shell/shellcorona.cpp
+++ b/shell/shellcorona.cpp
@@ -64,6 +64,8 @@
 
 #include "plasmashelladaptor.h"
 
+#include "../lookandfeelaccess/lookandfeelaccess.h"
+
 static const int s_configSyncDelay = 10000; // 10 seconds
 
 class ShellCorona::Private {
@@ -176,8 +178,9 @@ ShellCorona::ShellCorona(QObject *parent)
     themeName = plasmarc.readEntry(themeNameKey, themeName);
 
     if (themeName.isEmpty()) {
+        LookAndFeelAccess access;
         const KConfigGroup lnfCfg = KConfigGroup(KSharedConfig::openConfig(
-                                                lookAndFeelPackage().filePath("defaults")),
+                                                access.filePath("defaults")),
                                                 themeGroupKey
                                            );
         themeName = lnfCfg.readEntry(themeNameKey, themeName);
@@ -1316,17 +1319,6 @@ void ShellCorona::desktopContainmentDestroyed(QObject *obj)
     }
 }
 
-Plasma::Package ShellCorona::lookAndFeelPackage() const
-{
-    if (!d->lookNFeelPackage.isValid()) {
-        d->lookNFeelPackage = ShellPluginLoader::self()->loadPackage("Plasma/LookAndFeel");
-        //TODO: make loading from config once we have some UI for setting the package
-        d->lookNFeelPackage.setPath("org.kde.lookandfeel");
-    }
-
-    return d->lookNFeelPackage;
-}
-
 KScreen::Config* ShellCorona::screensConfiguration() const
 {
     return d->screenConfiguration;
diff --git a/shell/shellcorona.h b/shell/shellcorona.h
index 2228b76..6bdeaf0 100644
--- a/shell/shellcorona.h
+++ b/shell/shellcorona.h
@@ -71,8 +71,6 @@ public:
 
     KActivities::Controller *activityController();
 
-    Plasma::Package lookAndFeelPackage() const;
-
     //Those two are a bit of an hack but are just for desktop scripting
     Activity *activity(const QString &id);
     void insertActivity(const QString &id, Activity *activity);
-- 
2.0.1

