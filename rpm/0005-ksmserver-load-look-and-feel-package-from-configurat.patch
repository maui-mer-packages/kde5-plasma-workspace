From 681aad9fc96195686865d5aa38a8e6fdc654650a Mon Sep 17 00:00:00 2001
From: Pier Luigi Fiorini <pierluigi.fiorini@gmail.com>
Date: Thu, 3 Jul 2014 21:48:29 +0200
Subject: [PATCH 5/5] ksmserver load look and feel package from configuration

---
 ksmserver/screenlocker/greeter/greeterapp.cpp | 7 ++++++-
 ksmserver/shutdowndlg.cpp                     | 7 ++++++-
 2 files changed, 12 insertions(+), 2 deletions(-)

diff --git a/ksmserver/screenlocker/greeter/greeterapp.cpp b/ksmserver/screenlocker/greeter/greeterapp.cpp
index 14bf3db..b977a9c 100644
--- a/ksmserver/screenlocker/greeter/greeterapp.cpp
+++ b/ksmserver/screenlocker/greeter/greeterapp.cpp
@@ -104,9 +104,14 @@ void UnlockApp::initialize()
     KCrash::setDrKonqiEnabled(false);
 
     KScreenSaverSettings::self()->readConfig();
+
     ShellPluginLoader::init();
+
+    KConfigGroup kdeglobals(KSharedConfig::openConfig("kdeglobals"), QStringLiteral("General"));
+    const QString lookAndFeel = kdeglobals.readEntry(QStringLiteral("LookAndFeel"), QStringLiteral("org.kde.lookandfeel"));
+
     m_package = Plasma::PluginLoader::self()->loadPackage("Plasma/LookAndFeel");
-    m_package.setPath("org.kde.lookandfeel");
+    m_package.setPath(lookAndFeel);
 
     m_mainQmlPath = QUrl::fromLocalFile(m_package.filePath("lockscreenmainscript"));
 
diff --git a/ksmserver/shutdowndlg.cpp b/ksmserver/shutdowndlg.cpp
index ccf6dd9..caa7061 100644
--- a/ksmserver/shutdowndlg.cpp
+++ b/ksmserver/shutdowndlg.cpp
@@ -152,8 +152,13 @@ KSMShutdownDlg::KSMShutdownDlg( QWindow* parent,
     QString fileName;
     if(theme.isEmpty()) {
         ShellPluginLoader::init();
+
+        KConfigGroup kdeglobals(KSharedConfig::openConfig("kdeglobals"), QStringLiteral("General"));
+        const QString lookAndFeel = kdeglobals.readEntry(QStringLiteral("LookAndFeel"), QStringLiteral("org.kde.lookandfeel"));
+
         Plasma::Package pkg = Plasma::PluginLoader::self()->loadPackage("Plasma/LookAndFeel");
-        pkg.setPath("org.kde.lookandfeel");
+        pkg.setPath(lookAndFeel);
+
         fileName = pkg.filePath("logoutmainscript", QString());
     } else
         fileName = theme;
-- 
1.9.1

